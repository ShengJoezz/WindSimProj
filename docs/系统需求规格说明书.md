# 系统需求规格说明书

## 1. 引言

### 1.1. 编写目的
本文档旨在详细、准确地阐述平台的功能性需求、非功能性需求、接口及数据需求。其主要目的在于：
- 为项目开发团队提供清晰、无歧义的设计与开发依据。
- 为测试团队提供制定测试计划和测试用例的基准。
- 作为项目管理和未来版本迭代的纲领性文件。

### 1.2. 项目背景
项目旨在为风能工程师和科研人员提供一个集成了地理信息系统（GIS）、计算流体动力学（CFD）和高级数据可视化功能于一体的专业Web平台。用户能够通过本平台，便捷地配置、运行复杂的风场仿真计算，并对结果进行直观、多维度的分析，从而辅助风资源评估、风机选址和环境影响评价等决策。

### 1.3. 定义与术语表
- **工况 (Case)**: 系统中的核心概念，指一个独立的、自包含的仿真项目。它以一个文件夹的形式存在，内部包含了该项目的所有输入数据、配置文件和输出结果。
- **DEM**: 数字高程模型 (Digital Elevation Model)，描述地表高程的栅格数据文件。
- **VTK**: The Visualization Toolkit，一个用于3D计算机图形、图像处理和可视化的开源软件系统。
- **info.json**: 关键的配置文件。由系统根据用户的所有输入（参数、风机、地形等）自动生成，是驱动后端Python计算引擎的唯一、最终的输入文件。
- **BFF**: Backend-for-Frontend，一种架构模式，即为前端定制的后端服务。
- **SPA**: 单页应用 (Single-Page Application)。

---

## 2. 总体描述

### 2.1. 产品概述
平台提供了一个从数据准备、参数配置、启动计算到结果分析的全流程解决方案。产品特性包括：
- **Web化的交互界面**: 用户无需安装复杂的桌面软件，通过浏览器即可完成所有操作。
- **强大的可视化能力**: 集成VTK.js、Plotly.js等库，支持2D和3D地理空间及流场数据的交互式可视化。
- **灵活的参数配置**: 提供丰富的参数选项，支持包括地表粗糙度和风机性能曲线在内的高级输入。
- **异步计算与实时监控**: 计算任务在后端异步执行，前端可通过WebSocket实时获取计算状态和日志。

### 2.2. 运行环境
- **服务器端**: 操作系统需为Linux（推荐Ubuntu 22.04+），必须安装Docker及Docker Compose，并具备Node.js (v20+)和Python (v3.8+)环境及相关科学计算库。
- **客户端**: 需使用支持WebGL 2.0的现代桌面浏览器（如Chrome, Firefox, Edge的最新版本）。

---

### 3. 功能需求

#### 3.1. 功能模块划分

为更清晰地反映系统核心能力，功能模块重新划分为：

1.  **工况与数据管理模块**: (FR-1) 负责工况生命周期管理及基础数据（地形、粗糙度等）的配置。
2.  **仿真前处理模块**: (FR-2) 负责测风数据分析、计算网格生成等计算前的准备工作。
3.  **核心计算与控制模块**: (FR-3) 负责配置并执行大气流场及风电场两种核心仿真任务。
4.  **结果后处理与可视化模块**: (FR-4) 负责对仿真输出结果进行多维度、交互式的可视化分析与数据导出。

### 3.2. 详细功能描述

#### 3.2.1. 工况与数据管理模块 (FR-1)

*   **FR-1.1 创建工况**: 系统**必须**提供创建新工况的功能，要求用户输入唯一的工况名称。优先级：高。
*   **FR-1.2 加载工况**: 系统**必须**提供列表以展示和加载已存在的工况。优先级：高。
*   **FR-1.3 删除工况**: 系统**必须**允许用户删除工况及其所有关联文件。优先级：中。
*   **FR-1.4 地形与粗糙度数据库**:
    *   **FR-1.4.1 内置数据库**: 系统**必须**内置经过处理的中国陆地区域地形与粗糙度数据库。优先级：高。
    *   **FR-1.4.2 用户自定义数据**: 系统**必须**支持用户上传、创建、修改和删除自定义的地形与粗糙度文件，并允许在项目中选择调用。优先级：高。

#### 3.2.2. 仿真前处理模块 (FR-2)

*   **FR-2.1 测风数据自动化处理**:
    *   **FR-2.1.1 数据导入**: 系统**必须**支持导入多个测风塔的数值数据资料。优先级：高。
    *   **FR-2.1.2 数据分析与绘图**: 系统**必须**能根据导入的数据，自动执行数据格式检验，并根据用户需求绘制风速风向玫瑰图、风能风频分布图，以及计算大气稳定度等关键参数。优先级：高。
*   **FR-2.2 复杂地形精细化与自适应网格划分**:
    *   **FR-2.2.1 网格生成**: 系统**必须**能基于项目选定的地形与粗糙度数据，在用户指定的任意大小范围内，自适应生成计算网格。优先级：高。
    *   **FR-2.2.2 关注区域加密**: 系统**必须**支持对计算域内用户指定的“关注区域”，进行网格的自适应加密处理。优先级：高。

#### 3.2.3. 核心计算与控制模块 (FR-3)

*   **FR-3.1 大气边界层流场数值模拟**:
    *   **FR-3.1.1 场景设置**: 系统**必须**允许用户设置区域内的来流风信息和计算信息（如：计算步长、时间、模型等）。优先级：高。
    *   **FR-3.1.2 启动计算**: 系统**必须**提供接口，以调用内置封装的复杂地形下大气边界层流场数值模拟程序代码对算例进行计算。优先级：高。
*   **FR-3.2 基于致动类模型的风电场数值模拟**:
    *   **FR-3.2.1 场景设置**: 系统**必须**允许用户设置区域来流风信息，并根据风电场布局信息设置风机点位信息。优先级：高。
    *   **FR-3.2.2 启动计算**: 系统**必须**提供接口，结合复杂地形精细化和自适应网格划分模块（FR-2.2），设置计算信息（计算步长、时间、模型等），并调用内置的基于致动类模型的风电场数值模拟程序代码进行计算。优先级：高。
*   **FR-3.3 任务执行与监控**: 系统**必须**提供“开始计算”功能以异步方式启动后端计算任务。在计算过程中，**必须**通过WebSocket实时推送进度和日志。优先级：高。

#### 3.2.4. 结果后处理与可视化模块 (FR-4)

*   **FR-4.1 三维粒子系统风场可视化**:
    *   **FR-4.1.1 场景渲染**: 系统**必须**利用计算程序得出的三维风场网格数据，基于WebGL三维可视化技术，对复杂地形进行三维场景可视化渲染，并支持缩放、旋转等交互操作。优先级：高。
    *   **FR-4.1.2 模型叠加**: 系统**必须**支持在三维场景中叠加显示风力机三维模型。优先级：高。
    *   **FR-4.1.3 切面分析与粒子效果**: 系统**必须**支持提取三维风场的任意剖面，并对风场进行三维粒子效果的可视化展示。优先级：高。
    *   **FR-4.1.4 GIS数据叠加**: 系统**必须**支持将仿真计算结果与GIS数据进行叠加展示。优先级：中。
*   **FR-4.2 数据导出**:
    *   **FR-4.2.1 场数据导出**: 系统**必须**能够实现计算区域任意点位、截面处流场展示与数据导出。优先级：高。

---

### 4. 非功能性需求

*   **NF-1 性能**:
    *   **响应时间**: 系统或界面的响应时间应在 **1-2 秒** 内（不含核心计算时间）。
    *   **系统处理能力**: 系统**必须**能处理 **≥1000万** 网格的计算和分析任务。
    *   **并发用户数**: 系统**必须**支持 **≥20** 个用户并发访问和操作。
    *   **3D渲染**: 交互帧率应不低于25 FPS。
*   **NF-2 可靠性**:
    *   **稳定性**: 系统在最大容量的80%或标准压力（系统的预期日常压力）情况下，**必须**能够稳定运行的最短时间不少于 **24 小时**。
    *   **异步任务**: 客户端断开不应影响后端计算任务的正常执行。
    *   **错误处理**: 后端需有全局错误处理机制，并向前端返回明确、可理解的错误信息。
*   **NF-3 可用性**:
    *   **状态反馈**: 所有耗时操作（如数据上传、计算过程、结果加载）必须有明确的进度指示或状态反馈。
    *   **格式说明**: 对有格式要求的文件输入（如测风塔数据、自定义粗糙度文件），必须在UI上提供清晰的说明和示例。
*   **NF-4 兼容性**:
    *   **浏览器**: 必须兼容最新版的Chrome, Firefox, Edge，并要求客户端浏览器支持WebGL。

## 5. 接口需求

- **UI-1 用户界面**: 界面设计应专业、简洁，遵循一致的布局和交互模式。
- **SI-1 软件接口**: 
    - **后端API**: 提供基于HTTP的RESTful API，数据交换格式为JSON。
    - **Python调用接口**: Node.js通过命令行参数调用Python脚本，Python通过`stdout`打印JSON字符串返回信息。
- **CI-1 通信接口**: 
    - **实时通信**: 采用Socket.io (WebSocket)实现服务器到客户端的实时消息推送。

---

## 6. 其他需求

- **DR-1 数据管理**: 所有数据以文件形式存储在服务器本地文件系统。建议对工况目录进行定期备份。