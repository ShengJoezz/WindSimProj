### 基于CLCD生成地表粗糙度的技术依据与方法说明

**摘要**: 本文档旨在为利用中国30米年度土地覆盖数据（CLCD）生成地表粗糙度（rou）文件提供一套完整的技术依据和方法论解释。内容涵盖数据源的权威性、坐标系处理的合理性、关键参数选取的科学依据。

---

### 1. 方法论概述

本方法通过处理权威的土地覆盖遥感数据，将其映射为空气动力学粗糙度长度（z₀），并进一步推算出等效障碍物高度（h），最终生成适用于风场模拟的`.rou`格式文件。该流程是风能评估和大气边界层研究中的标准实践，确保了输入参数的科学性和可追溯性。

---

### 2. 数据来源与坐标系处理

#### 2.1. 数据来源：中国30米年度土地覆盖数据 (CLCD)

本流程采用的CLCD（China Land Cover Dataset）是由武汉大学团队发布的具有高时空分辨率的土地覆盖产品。

* **权威性与精度**: 该数据集基于Landsat影像，在Google Earth Engine平台上生成，提供了自1990年以来中国区域30米分辨率的逐年土地覆盖分类。 其分类系统包含耕地、森林、灌丛、草地、水体、雪/冰、裸地、不透水面/城镇及湿地九大类，与`mapping.yaml`中的分类相匹配。根据官方发布，该数据集的总体精度（Overall Accuracy）稳定在79%左右，能够满足区域尺度风场模拟对下垫面分类的需求。

* **数据格式与投影**: 数据以云优化GeoTIFF (COG) 格式提供，其中 `*_albert.tif` 文件采用了Albers等积投影，这是一种适用于国家尺度分析的标准投影方式。

  <img src="F:\研究生内容\工作项目\三峡金沙江下游项目\金下项目结项材料\课题一补充材料\QGIS_ROU.png" alt="QGIS_ROU" style="zoom: 25%;" />

#### 2.2. 坐标系处理流程

为了进行精确的距离和面积计算，并与主流风能模拟软件（如WAsP）的工作流保持一致，本方法对坐标系进行了标准化处理。

*   **重投影至UTM**: 脚本首先将Albers投影的CLCD数据裁剪并重投影到局地的通用横轴墨卡托（UTM）投影。UTM是WGS84坐标系下的分区投影，以米为单位，是风能和地形分析领域的推荐做法，能有效避免地理坐标系（经纬度）在高纬度地区的变形问题。
*   **处理工具与方法**: 整个流程利用了地理空间数据处理的“黄金标准”工具集——GDAL。 `gdalbuildvrt` 用于构建虚拟栅格以拼接数据，`gdalwarp` 则负责裁剪和重投影。
    *   **重采样方法**: 在处理分类栅格数据（如土地覆盖类型）时，为防止类别值被插值计算污染（例如，将“水体”和“森林”插值为一个不存在的中间类别），脚本采用了`nearest-neighbor`（最近邻）重采样方法。这在GDAL文档和行业实践中被明确推荐为分类数据的最佳实践。

---

### 3. 关键参数的选取依据

#### 3.1. 从土地覆盖到粗糙度长度 (z₀) 的映射

将土地覆盖类型通过查表法映射为粗糙度长度z₀是大气科学和风工程领域的成熟方法。 本流程中文件定义的z₀值参考了多个权威来源，包括WMO（世界气象组织）指南、EPA（美国环保署）手册以及Davenport–Wieringa分类等。该参数基于文献和行业标准的初始配置，可根据场址的实测数据或再分析风气候数据进行局地化校正。

**各类别z₀取值依据**:
*   **水体 (Water)**: 0.0002 m。这是一个典型的开阔水面z₀值。部分风能软件（如WAsP）为特殊标识，会将水体z₀设为0。
*   **草地 (Grassland)**: 0.05 m。处于常见草地/开阔地z₀范围 (0.03–0.05 m) 内。
*   **耕地 (Cropland)**: 0.10 m。位于低矮作物的z₀范围 (0.10–0.25 m) 内。
*   **灌丛/湿地 (Shrub/Wetland)**: 0.07 m。属于灌木地表的z₀范围 (0.05–0.5 m)。
*   **裸地 (Barren)**: 0.02 m。符合荒地的z₀典型值 (0.01–0.03 m)。
*   **森林 (Forest)**: 0.50 m。这是一个相对保守的森林z₀值，文献中常见范围为0.5–1.5 m。
*   **城镇 (Urban)**: 0.40 m。该值对应于郊区或低密度建成区，属于保守设定。市中心的z₀可达2m以上。
*   **雪/冰 (Snow/Ice)**: 0.001 m。与光滑冰雪表面的z₀值 (0.001–0.005 m) 一致。

**合理性说明**: 正如新欧洲风能图谱（NEWA）项目所指出的，土地覆盖到z₀的映射表不存在唯一的“真值”，而是一种工程化的约定。因此，将`mapping.yaml`作为一个可配置的参数文件是合理的，并允许用户根据特定场址的实际情况或验证数据进行后续优化。

#### 3.2. 从 z₀ 到植被高度 (h) 的换算: `h = a · z₀`

大气边界层理论和大量观测实验表明，粗糙度长度z₀与形成该粗糙度的障碍物（如植被）高度h之间存在近似线性的正比关系。

*   **经验关系**: 通常，z₀ 约等于 (0.05–0.2)·h，其中“十分之一法则”（z₀ ≈ 0.1h）最为常用。反算可得 `h ≈ (5–20)·z₀`。
*   **参数 `a` 的选取**: 脚本中设置的默认`a_factor=20`，位于该经验范围的上沿。这是一种偏于保守的设定，倾向于生成一个较高的等效障碍物高度，避免在模型中低估植被对风的阻挡效应。
*   **理论支撑**: 更精细的冠层参数化方案（如Raupach, 1994）也将z₀与冠层高度h联系起来，并指出两者关系受叶面积指数（LAI）等因素影响，这进一步说明了将`a`作为一个可调整的工程系数的合理性。

#### 3.3. 季节性调整系数 (`vege-times`)

植被的z₀值存在显著的季节性变化，例如，落叶林在冬季的z₀会远小于夏季。 脚本中引入的全局乘子`vege-times`（默认为1.0）提供了一种简便的工程化手段，用于模拟不同季节（如“叶季”与“非叶季”）或进行情景分析，例如，冬季可设为0.5–0.8，夏季为1.0。

---

### 4. 文件结构与代码实现

#### 4.1. `.rou` 文件格式的合理性

将粗糙度信息表达为等值线或点集是风能模拟软件的通行做法。

*   **行业先例**: WAsP软件使用`.map`文件（矢量线格式）来定义粗糙度变化区域，而WindSim等CFD软件也支持类似的网格化或矢量格式。Global Mapper等GIS工具也内置了从土地覆盖图层直接生成和导出粗糙度图的功能。
*   **格式兼容性**: 脚本生成的`.rou`文件是一种自定义的文本格式，通过分组等值线的形式同时记录了z₀和h。这种“左侧z₀、右侧z₀、高度、点数及坐标列”的线要素格式变体在WAsP等软件中亦有先例。只要下游的读取脚本能够正确解析，这种格式就是完全可行的。

#### 4.2. 脚本关键参数与实现细节

*   **`sample` (采样间距)**: 默认为100米。考虑到CLCD的原始分辨率为30米，采用100米的采样间距可以在大幅降低数据量的同时，保留下垫面粗糙度的主要空间分布特征。欧洲NEWA项目中的z₀底图也采用了百米级别的分辨率。
*   **`quant_step_m` (高度量化步长)**: 默认为0.5米。该参数用于对计算出的植被高度h进行分组，以压缩等值线的数量。0.5米的步长远小于当前通过卫星遥感反演冠层高度的典型误差（RMSE通常在4-9米量级），因此这种量化不会引入实质性的精度损失。
*   **裁剪缓冲 (Buffer)**: 在裁剪和重投影时增加5%的缓冲区域，可以有效避免因重采样窗口外推而导致的边界像素丢失，是栅格数据处理中的常见技巧。
*   **无效值处理 (`-dstNodata 0`)**: 将输出的无效数据值设为0，并在后续处理中滤除，这与多数土地覆盖产品（通常类别编码从1开始，0代表无数据）的约定一致，避免了将数据空洞误判为有效类别。

---

### 5. 代码使用方法

该工具通过一个Python脚本 (`generate_rou.py`) 实现，依赖GDAL、NumPy、Rasterio和PyYAML等库。

**基本使用流程**:
1.  **准备数据**:
    *   获取CLCD数据，可以是全国单文件 (`--clcd`) 或按省份存放的文件夹 (`--clcd-dir`)。
    *   配置`mapping.yaml`文件，根据需求调整土地覆盖类别与z₀的映射关系、`a_factor`等参数。

2.  **执行命令**:
    在命令行中运行脚本，并提供必要的参数。

    ```bash
    python generate_rou.py \
        --clcd-dir /path/to/your/clcd_data_directory \
        --center "39.9,116.4" \
        --r2 25000 \
        --out /path/to/output/rou_file.rou \
        --mapping /path/to/your/mapping.yaml
    ```

**参数说明**:
*   `--clcd-dir` 或 `--clcd`: 指定CLCD数据源。
*   `--center`: 指定模拟区域的中心点纬度和经度。
*   `--r2`: 指定模拟区域的半径（米）。
*   `--out`: 指定输出`.rou`文件的路径。
*   `--mapping`: 指定参数映射文件的路径。
*   `--a`: 可选，用于覆盖`mapping.yaml`中定义的`a_factor`。
*   `--vege-times`: 可选，用于季节性调整。
*   `--sample`: 可选，采样间距。
*   `--quant`: 可选，高度量化步长。

**输出**:
脚本执行成功后，将会在指定路径生成一个`.rou`文件，该文件可被下游风场模拟工具读取，用于定义地表粗糙度。

---

### 6. 结论与建议

该rou生成链路（CLCD → z0 → h → rou）在数据源、处理流程、参数选取和文件格式上均有充分的科学依据和行业先例支持，是一套合理且可复现的技术方案。

*   **建议**: 在文档或论文的方法部分，建议明确声明`mapping.yaml`中的参数为“基于文献和行业标准的初始配置”，并指出这些参数可“根据场址的实测数据或再分析风气候数据进行局地化校正”，以体现研究的严谨性。对于城镇和水体等特殊下垫面，应根据目标模拟软件（如LES/CFD或WAsP）的具体要求，确认z₀的取值约定。