<!--
 * @Author: joe 847304926@qq.com
 * @Date: 2025-03-17 15:41:56
 * @LastEditors: joe 847304926@qq.com
 * @LastEditTime: 2025-03-17 15:53:04
 * @FilePath: \\wsl.localhost\Ubuntu-22.04\home\joe\wind_project\WindSimProj\backend\templates\report-template.html
 * @Description:
 *
 * Copyright (c) 2025 by joe, All Rights Reserved.
-->

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>风场流场计算报告</title>
  <style>
    body {
      font-family: 'NotoSansSC', Arial, sans-serif;
      margin: 0;
      padding: 0;
      color: #333;
      font-size: 12px;
    }

    .page {
      page-break-after: always;
      padding: 20px 0;
    }

    .last-page {
      page-break-after: avoid;
    }

    .cover {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 800px;
      background-color: #f0f7ff;
      padding: 20px;
      border-radius: 10px;
    }

    h1 {
      font-size: 24px;
      color: #1e3178;
      margin-bottom: 20px;
    }

    h2 {
      font-size: 18px;
      color: #1e3178;
      margin-bottom: 15px;
      margin-top: 30px;
    }

    h3 {
      font-size: 16px;
      color: #3c4043;
      margin-bottom: 10px;
      margin-top: 20px;
    }

    p {
      margin: 5px 0;
      line-height: 1.5;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th {
      background-color: #4285f4;
      color: white;
      padding: 8px;
      text-align: left;
      font-weight: bold;
    }

    td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }

    tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    .status-box {
      background-color: #f0f7ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background-color: #f0f7ff;
      border-radius: 8px;
      padding: 15px;
      min-width: 180px;
      flex: 1;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }

    .note {
      font-style: italic;
      color: #666;
      margin: 10px 0;
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      font-size: 10px;
      color: #999;
    }

    /* 新增样式 */
    .comparison-table {
      font-size: 11px;
    }

    .comparison-table th {
      font-size: 11px;
      padding: 6px;
    }

    .comparison-table td {
      padding: 6px;
      text-align: right;
    }

    .comparison-table tr td:first-child {
      text-align: left;
      font-weight: bold;
    }

    .performance-section {
      margin-bottom: 30px;
    }

    .change-positive {
      color: #34a853;
    }

    .change-negative {
      color: #ea4335;
    }

    .change-neutral {
      color: #fbbc05;
    }

    .data-summary {
      background-color: #f9f9fb;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #4285f4;
    }

    .data-summary h4 {
      margin-top: 0;
      color: #4285f4;
    }
  </style>
</head>
<body>
  <!-- 封面页 -->
  <div class="page cover">
    <h1>风场流场计算报告</h1>
    <h2>工况名称: {{ caseName }}</h2>
    <p style="font-size: 14px;">工程中心坐标，待补充</p> <!-- centerCoordinates removed as no direct mapping -->
    <p style="margin-top: 20px;">报告生成日期: {{ reportDate }}</p> <!-- dateGenerated removed as no direct mapping, replaced with reportDate -->
    <p>报告生成时间: {{ reportTime }}</p> <!-- timeGenerated removed as no direct mapping, replaced with reportTime -->
  </div>

  <!-- 计算参数页 -->
  <div class="page">
    <h1>1. 计算参数概览</h1>

    <h3>计算域</h3>
    <div style="margin-left: 20px;">
      <p>宽度: {{ parameters.calculationDomain.width }} m</p>
      <p>高度: {{ parameters.calculationDomain.height }} m</p>
    </div>

    <h3>风向条件</h3>
    <div style="margin-left: 20px;">
      <p>风向角: {{ parameters.conditions.windDirection }}°</p>
      <p>入口风速: {{ parameters.conditions.inletWindSpeed }} m/s</p>
    </div>

    <h3>网格配置</h3>
    <table>
      <thead>
        <tr>
          <th style="width: 40%;">参数</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>加密区高度</td>
          <td>{{ parameters.grid.encryptionHeight }} m</td>
        </tr>
        <tr>
          <td>加密层数</td>
          <td>{{ parameters.grid.encryptionLayers }}</td>
        </tr>
        <tr>
          <td>网格生长率</td>
          <td>{{ parameters.grid.gridGrowthRate }}</td>
        </tr>
        <tr>
          <td>最大待证长度</td>
          <td>{{ parameters.grid.maxExtensionLength }} m</td>
        </tr>
        <tr>
          <td>加密区径向长度</td>
          <td>{{ parameters.grid.encryptionRadialLength }} m</td>
        </tr>
        <tr>
          <td>尾流区径向长度</td>
          <td>{{ parameters.grid.downstreamRadialLength }} m</td>
        </tr>
        <tr>
          <td>加密半径</td>
          <td>{{ parameters.grid.encryptionRadius }} m</td>
        </tr>
        <tr>
          <td>加密过渡半径</td>
          <td>{{ parameters.grid.encryptionTransitionRadius }} m</td>
        </tr>
        <tr>
          <td>地形半径</td>
          <td>{{ parameters.grid.terrainRadius }} m</td>
        </tr>
        <tr>
          <td>地形过渡半径</td>
          <td>{{ parameters.grid.terrainTransitionRadius }} m</td>
        </tr>
        <tr>
          <td>尾流区长度</td>
          <td>{{ parameters.grid.downstreamLength }} m</td>
        </tr>
        <tr>
          <td>尾流区宽度</td>
          <td>{{ parameters.grid.downstreamWidth }} m</td>
        </tr>
        <tr>
          <td>缩放比</td>
          <td>{{ parameters.grid.scale }}</td>
        </tr>
      </tbody>
    </table>

    <h3>仿真配置</h3>
    <table>
      <thead>
        <tr>
          <th style="width: 40%;">参数</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>核数</td>
          <td>{{ parameters.simulation.cores }}</td>
        </tr>
        <tr>
          <td>步数</td>
          <td>{{ parameters.simulation.steps }}</td>
        </tr>
        <tr>
          <td>时间步长</td>
          <td>{{ parameters.simulation.deltaT }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 风机布局页 -->
  <div class="page">
    <h1>2. 风机布局与数据</h1>

    <p style="font-size: 14px; margin-bottom: 15px;">风机总数: {{ windTurbines.length }}</p>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>经度</th>
          <th>纬度</th>
          <th>轮毂高度 (m)</th>
          <th>叶轮直径 (m)</th>
          <th>类型</th>
        </tr>
      </thead>
      <tbody>
        {{#each windTurbines}}
          <tr>
            <td>{{ this.id }}</td>
            <td>{{ this.longitude }}</td>
            <td>{{ this.latitude }}</td>
            <td>{{ this.hubHeight }}</td>
            <td>{{ this.rotorDiameter }}</td>
            <td>{{ this.type }}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>

    {{#if windTurbines }}
      {{#gt windTurbines.length 20}}
        <p class="note">注: 表格中仅显示部分风机数据，完整数据请参考应用程序。</p>
      {{/gt}}
    {{else}}
      <p class="note">未添加风机数据。</p>
    {{/if}}
  </div>

  <!-- 流场结果页 -->
  <div class="page">
    <h1>3. 流场计算结果</h1>

    <p class="note">由于技术限制，报告中不能直接包含三维渲染和速度场图像。请在应用程序界面中查看完整的流场可视化结果。</p>

    <div class="status-box">
      <h3 style="margin-top: 0;">计算状态</h3>
      <p style="font-weight: bold; color: {{ status.statusColor }}"> <!-- status.statusColor will be defined based on calculationStatus -->
        当前状态: {{ status.statusText }} <!-- status.statusText will be defined based on calculationStatus -->
      </p>

      {{#if calculationStatusCompleted }} <!-- calculationStatus helper function for 'completed' -->
        <p>计算已成功完成，可在应用程序中查看详细结果。</p>
      {{else if calculationStatusRunning }} <!-- calculationStatus helper function for 'running' -->
        <p>当前进度: {{ overallProgress }}%</p>
      {{/if}}
    </div>

    <h3>3.1 流场数据统计</h3>
    <table>
      <thead>
        <tr>
          <th style="width: 30%;">指标</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>平均风速</td>
          <td>{{#if results.avgWindSpeed}}{{ results.avgWindSpeed }} m/s{{else}}报告生成时暂无数据{{/if}}</td>
        </tr>
        <tr>
          <td>最大风速</td>
          <td>{{#if results.maxWindSpeed}}{{ results.maxWindSpeed }} m/s{{else}}报告生成时暂无数据{{/if}}</td>
        </tr>
        <tr>
          <td>最小风速</td>
          <td>{{#if results.minWindSpeed}}{{ results.minWindSpeed }} m/s{{else}}报告生成时暂无数据{{/if}}</td>
        </tr>
        <tr>
          <td>湍流强度</td>
          <td>{{#if results.turbulenceIntensity}}{{ results.turbulenceIntensity }}{{else}}报告生成时暂无数据{{/if}}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 风机性能分析页 -->
  <div class="page">
    <h1>4. 风机性能分析</h1>

    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-label">风机数量</div>
        <div class="stat-value">{{ turbineCount }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">平均风速</div>
        <div class="stat-value">{{#if avgSpeed}}{{ avgSpeed }} m/s{{else}}N/A{{/if}}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">总功率</div>
        <div class="stat-value">{{#if totalPower}}{{ totalPower }} kW{{else}}N/A{{/if}}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">平均推力系数</div>
        <div class="stat-value">{{#if avgCt}}{{ avgCt }}{{else}}N/A{{/if}}</div>
      </div>
    </div>

    <div class="data-summary">
      <h4>性能调整概述</h4>
      <p>通过流场仿真和动态调整，风机群整体性能获得了优化：</p>
      <ul>
        <li>入口风速：{{ parameters.conditions.inletWindSpeed }} m/s</li>
        <li>调整后平均风速：{{#if avgSpeed}}{{ avgSpeed }} m/s{{else}}暂无数据{{/if}}</li>
        <li>平均风速变化：{{#if avgSpeed}}{{ avgSpeedChange }} %{{else}}暂无数据{{/if}}</li> <!-- avgSpeedChange needs to be calculated -->
        <li>总发电量：{{#if totalPower}}{{ totalPower }} kW{{else}}暂无数据{{/if}}</li>
      </ul>
    </div>

    <h3>4.1 风机位置与性能分布</h3>

    <p>风机在风场中的分布与各自性能密切相关。根据计算结果，我们可以观察到以下分布规律：</p>

    <ul>
      <li>上风向风机：获得更高的风速和功率输出</li>
      <li>下风向风机：受尾流影响，性能有所降低</li>
      <li>边缘位置风机：受地形影响较明显</li>
    </ul>

    <p>详细的位置与性能关系分析可以参考应用程序中的空间分布图表。</p>

    <h3>4.2 初始与调整后风机性能对比</h3>

    <table class="comparison-table">
      <thead>
        <tr>
          <th colspan="3">调整前后性能变化统计</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>平均风速变化</td>
          <td colspan="2">{{ avgSpeedChange }} %</td> <!-- avgSpeedChange needs to be calculated -->
        </tr>
        <tr>
          <td>总功率变化</td>
          <td colspan="2">{{ totalPowerChange }} %</td> <!-- totalPowerChange needs to be calculated -->
        </tr>
        <tr>
          <td>推力系数平均变化</td>
          <td colspan="2">{{ avgCtChange }} %</td> <!-- avgCtChange needs to be calculated -->
        </tr>
      </tbody>
    </table>

    <p class="note">注：以上数据是基于当前风向和风速条件下的计算结果，实际运行性能会随气象条件变化而不同。</p>
  </div>

  <!-- 风机性能分析页（续） -->
  <div class="page last-page">
    <h3>4.3 风机性能详细数据表</h3>

    <p>下表展示了风场中各风机的详细性能参数（最多显示10台风机）：</p>

    <table class="comparison-table">
      <thead>
        <tr>
          <th>风机ID</th>
          <th>初始风速 (m/s)</th>
          <th>调整后风速 (m/s)</th>
          <th>初始功率 (kW)</th>
          <th>调整后功率 (kW)</th>
          <th>调整后推力系数</th>
        </tr>
      </thead>
      <tbody>
        <!-- 使用原始数据循环，最多显示10个风机 -->
        {{#each combinedData}}
          {{#if @indexLessThan10 }} <!-- helper function for index < 10 -->
          <tr>
            <td>{{ this.id }}</td>
            <td>{{ this.initSpeed }}</td>
            <td>{{ this.adjSpeed }}</td>
            <td>{{ this.initPower }}</td>
            <td>{{ this.adjPower }}</td>
            <td>{{ this.adjCt }}</td>
          </tr>
          {{/if}}
        {{/each}}
      </tbody>
    </table>

    {{#if turbineDataTooLong }} <!-- turbineDataTooLong helper function, e.g., combinedData.length > 10 -->
      <p class="note">注：风机数量超过10台，表格仅显示前10台风机数据。完整数据请参考应用程序。</p>
    {{/if}}

    <h3>4.4 风场优化建议</h3>

    <p>基于当前的流场计算和风机性能分析，针对该风场提出以下优化建议：</p>

    <div style="margin-left: 20px;">
      <p><strong>风机布局优化：</strong>在主导风向上，风机间距应不小于叶轮直径的8倍，以减少尾流影响。</p>
      <p><strong>风机类型选择：</strong>根据当地风况和地形条件，推荐选择适合中等风速的风机类型。</p>
      <p><strong>运行策略调整：</strong>在特定风向条件下，可考虑对部分风机进行偏航控制，减少尾流影响。</p>
    </div>

    <p class="note">以上建议基于单一工况计算结果，实际应用时应结合多工况和长期气象数据进行综合评估。</p>

    <div class="footer">
      <p>风场流场计算报告 - {{ caseName }} - 第 5 页</p> <!-- Page number might need dynamic handling -->
      <p>© 2025 风场流场仿真系统</p>
    </div>
  </div>
</body>
</html>